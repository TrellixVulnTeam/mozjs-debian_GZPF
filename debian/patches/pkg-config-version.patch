From 1530e05e2f55460c10f0a74b0a5d2ae63f0402c7 Mon Sep 17 00:00:00 2001
From: Rico Tzschichholz <ricotz@ubuntu.com>
Date: Wed, 5 Jul 2017 22:41:26 -0700
Subject: [PATCH] build: Add major version to make parallel installable

The js-config and js binaries and the js.pc pkg-config file need to be
disambiguated from the files with the same name installed by other mozjs
versions.

Patch ported forward to mozjs52 by Philip Chimento
<philip.chimento@gmail.com>.

https://bugzilla.mozilla.org/show_bug.cgi?id=1339931
---
 js/src/Makefile.in      |  7 +++++--
 js/src/old-configure.in | 13 +++++--------
 js/src/shell/moz.build  |  2 +-
 3 files changed, 11 insertions(+), 11 deletions(-)

diff --git a/js/src/Makefile.in b/js/src/Makefile.in
index fbcb90b4..4308e4c7 100644
--- a/js/src/Makefile.in
+++ b/js/src/Makefile.in
@@ -168,10 +168,13 @@ endif
 
 SCRIPTS = $(JS_CONFIG_NAME)
 
-$(LIBRARY_NAME).pc: js.pc
+$(JS_CONFIG_NAME): js-config
 	cp $^ $@
 
-install:: $(LIBRARY_NAME).pc
+$(JS_LIBRARY_NAME).pc: js.pc
+	cp $^ $@
+
+install:: $(JS_LIBRARY_NAME).pc
 	$(SYSINSTALL) $^ $(DESTDIR)$(libdir)/pkgconfig
 
 install:: js-config.h
diff --git a/js/src/old-configure.in b/js/src/old-configure.in
index 1c5c9e21..c40eb962 100644
--- a/js/src/old-configure.in
+++ b/js/src/old-configure.in
@@ -398,16 +398,13 @@ MOZJS_MINOR_VERSION=`echo $MOZILLA_VERSION | sed "s|^[0-9]*\.\([0-9]*\).*|\1|"`
 MOZJS_PATCH_VERSION=`echo $MOZILLA_VERSION | sed "s|^[0-9]*\.[0-9]*[^0-9]*||"`
 IS_ALPHA=`echo $MOZILLA_VERSION | grep '[ab]'`
 
-dnl XXX in a temporary bid to avoid developer anger at renaming files
-dnl XXX before "js" symlinks exist, don't change names.
-dnl
-dnl if test -n "$JS_STANDALONE"; then
-dnl JS_SHELL_NAME=js$MOZJS_MAJOR_VERSION
-dnl JS_CONFIG_NAME=js$MOZJS_MAJOR_VERSION-config
-dnl else
+if test -n "$JS_STANDALONE"; then
+JS_SHELL_NAME=js$MOZJS_MAJOR_VERSION
+JS_CONFIG_NAME=js$MOZJS_MAJOR_VERSION-config
+else
 JS_SHELL_NAME=js
 JS_CONFIG_NAME=js-config
-dnl fi
+fi
 
 changequote([,])
 if test -n "$IS_ALPHA"; then
diff --git a/js/src/shell/moz.build b/js/src/shell/moz.build
index 72ea8145..a982fe8a 100644
--- a/js/src/shell/moz.build
+++ b/js/src/shell/moz.build
@@ -64,4 +64,4 @@ FINAL_TARGET_PP_FILES += ['js-gdb.py.in']
 OBJDIR_FILES.js.src.shell += ['!/dist/bin/js-gdb.py']
 
 # People expect the js shell to wind up in the top-level JS dir.
-OBJDIR_FILES.js.src += ['!js%s' % CONFIG['BIN_SUFFIX']]
+OBJDIR_FILES.js.src += ['!js52%s' % CONFIG['BIN_SUFFIX']]

